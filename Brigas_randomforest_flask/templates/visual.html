<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forest Fire Prediction Dashboard</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- bootstrap core css -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/bootstrap.css') }}"
    />
    <!-- fonts style -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
    />
    <!--owl slider stylesheet -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"
    />
    <!-- nice select -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css"
      integrity="sha256-mLBIhmBvigTFWPSCtvdu6a76T+3Xyt+K571hupeFLg4="
      crossorigin="anonymous"
    />
    <!-- font awesome style -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/font-awesome.min.css') }}"
    />
    <!-- Custom styles for this template -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <!-- responsive style -->
    <link rel="stylesheet" href="{{ url_for('static',
    filename='css/responsive.css') }}"
  </head>
  <body>
    <header class="header_section">
      <div class="header_top">
        <div class="container-fluid header_top_container">
          <a class="navbar-brand" href="index.html">
            Forest<span>Fire</span>
          </a>
          <div class="contact_nav">
            <a href="{{ url_for('index') }}">
              <i class="fa fa-home" aria-hidden="true"></i>
              <span> Home </span>
            </a>
            <a href="{{ url_for('data') }}">
              <i class="fa fa-database" aria-hidden="true"></i>
              <span> Data Kebakaran </span>
            </a>
            <a href="{{ url_for('visual') }}">
              <i class="fa fa-globe" aria-hidden="true"></i>
              <span> Prediksi Kebakaran </span>
            </a>
            <a href="{{ url_for('predict1') }}">
              <i class="fa fa-globe" aria-hidden="true"></i>
              <span> Input Data </span>
            </a>
          </div>
        </div>
      </div>
      <div class="header_bottom">
        <div class="container-fluid">
          <nav class="navbar navbar-expand-lg custom_nav-container">
            <a class="navbar-brand navbar_brand_mobile" href="index.html">
              Forest<span>Fire</span>
            </a>
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class=""> </span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="{{ url_for('visual3') }}"
                    onclick="showSelectedData('Ponorogo')"
                  >
                    Ponorogo
                  </a>
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="{{ url_for('visual4') }}"
                    onclick="showSelectedData('Situbondo')"
                    >Situbondo</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="{{ url_for('visual2') }}"
                    onclick="showSelectedData('Nganjuk')"
                    >Nganjuk</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="{{ url_for('visual') }}"
                    onclick="showSelectedData('Bojonegoro')"
                    >Bojonegoro</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="{{ url_for('visual1') }}"
                    onclick="showSelectedData('Kabupaten Madiun')"
                    >Kabupaten Madiun</a
                  >
                </li>
              </ul>
            </div>

            <script>
              function showSelectedData(dataName) {
                alert("Anda memilih data: " + dataName);
              }
            </script>
          </nav>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <!-- Page Heading -->
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Forest Fire Prediction Dashboard</h1>
      </div>

      <!-- Chart -->
      <div class="row">
        <!-- Monthly Fire Predictions vs Actual Fires -->
        <div class="col-lg-6 mb-4">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">
                Monthly Fire Predictions vs Actual Fires
              </h6>
            </div>
            <div class="card-body">
              <canvas id="fireChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Feature Importances -->
        <div class="col-lg-6 mb-4">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">
                Feature Importances
              </h6>
            </div>
            <div class="card-body">
              <canvas id="featureImportanceChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Residuals -->
        <div class="col-lg-6 mb-4">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Residuals</h6>
            </div>
            <div class="card-body">
              <canvas id="residualChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Metrics -->
        <div class="col-lg-6 mb-4">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">
                Model Performance Metrics
              </h6>
            </div>
            <div class="card-body">
              <p id="r2-score"></p>
              <p id="mse-score"></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      $(document).ready(function () {
        $.getJSON("/bojonegoro", function (data) {
          const months = data.months;
          const actualFires = data.actual_num_fires;
          const predictedFires = data.avg_predictions;
          const featureImportances = data.feature_importances;
          const features = data.features;
          const residuals = data.residuals;
          const r2 = data.avg_r2;
          const mse = data.avg_mse;

          // Fire Chart
          const fireCtx = document.getElementById("fireChart").getContext("2d");
          new Chart(fireCtx, {
            type: "line",
            data: {
              labels: months,
              datasets: [
                {
                  label: "Actual Number of Fires",
                  data: actualFires,
                  borderColor: "rgba(75, 192, 192, 1)",
                  backgroundColor: "rgba(75, 192, 192, 0.2)",
                  fill: false,
                },
                {
                  label: "Predicted Number of Fires",
                  data: predictedFires,
                  borderColor: "rgba(255, 99, 132, 1)",
                  backgroundColor: "rgba(255, 99, 132, 0.2)",
                  fill: false,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  display: true,
                  title: {
                    display: true,
                    text: "Month",
                  },
                },
                y: {
                  display: true,
                  title: {
                    display: true,
                    text: "Number of Fires",
                  },
                },
              },
            },
          });

          // Feature Importance Chart
          const featureCtx = document
            .getElementById("featureImportanceChart")
            .getContext("2d");
          new Chart(featureCtx, {
            type: "bar",
            data: {
              labels: features,
              datasets: [
                {
                  label: "Feature Importance",
                  data: featureImportances,
                  backgroundColor: "rgba(153, 102, 255, 0.2)",
                  borderColor: "rgba(153, 102, 255, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  display: true,
                  title: {
                    display: true,
                    text: "Features",
                  },
                },
                y: {
                  display: true,
                  title: {
                    display: true,
                    text: "Importance",
                  },
                },
              },
            },
          });

          // Residual Chart
          const residualCtx = document
            .getElementById("residualChart")
            .getContext("2d");
          new Chart(residualCtx, {
            type: "line",
            data: {
              labels: months,
              datasets: [
                {
                  label: "Residuals",
                  data: residuals,
                  borderColor: "rgba(54, 162, 235, 1)",
                  backgroundColor: "rgba(54, 162, 235, 0.2)",
                  fill: false,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  display: true,
                  title: {
                    display: true,
                    text: "Month",
                  },
                },
                y: {
                  display: true,
                  title: {
                    display: true,
                    text: "Residuals",
                  },
                },
              },
            },
          });

          $("#r2-score").text(`Average R-squared (R2) Score: ${r2}`);
          $("#mse-score").text(`Average Mean Squared Error (MSE): ${mse}`);
        });
      });
    </script>
  </body>
</html>
